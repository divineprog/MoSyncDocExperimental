<!DOCTYPE html>
<html>
<head>
    <title>Event-Driven OO Applications</title>

    <meta name="viewport" content="width=devicewidth,initial-scale=1.0,user-scalable=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <link rel="stylesheet" href="../../../../../js/jquery.mobile-1.3.0/jquery.mobile-1.3.0.min.css" />

    <style>
    .ui-header .ui-title
    {
        margin-right: 10%;
        margin-left: 10%;
    }
    </style>

    <script src="../../../../../js/jquery.mobile-1.3.0/jquery.js"></script>

    <script>
    // Do one-time initialisation here.
    $(document).bind('mobileinit', function() {
        // Set default transitions.
        $.mobile.defaultPageTransition = "none";
        $.mobile.defaultDialogTransition = "none";
    });
    </script>

    <script src="../../../../../js/jquery.mobile-1.3.0/jquery.mobile-1.3.0.min.js"></script>

    <script>
    /*
    // Insert header and panel into page.
    $(document).on("pagebeforecreate", function(event)
    {
        console.log("pagebeforecreate: " + event.target.id);
        $("#" + event.target.id).append($("#slide-panel").html());
        $("#" + event.target.id).prepend($("#slide-header").html());
        // No need to call .trigger('create') here.
    });

    function showSlide(slideId)
    {
        console.log("Show slide: " + slideId);
        console.log($("#" + slideId).html());
        $("#slide-container").html(
            $("#" + slideId).html());
        $("#page-slide").trigger("create");
        //$("#panel-content").panel("close");
    }
    */
    
    function showDocPage(path)
    {
        /*$.mobile.changePage(path, { 
            //pageContainer: $("#page-content"),
            //role: "content",
            transition: "none" });
        */
        $("#page-content").load(path);
    }
</script>
</head>

<body>
    <div data-role="page" id="page-template">
        
        <div data-role="header" data-position="fixed">
            <h1>Event-Driven OO Applications</h1>
            <a href="#panel-content"
                class="ui-btn-left"
                data-icon="bars">Content</a>
            <a rel="external"
                href="../../../../home/index.html"
                class="ui-btn-right"
                data-icon="home">Home</a>
        </div>
        
        <div data-role="content" id="page-content">
            
<p>The <strong>MAUtil::Moblet</strong> C++ class provides boilerplate event handling and produces well-behaved, resource-efficient programs. It helps provide a higher-level abstraction of program flow.</p>
<p>
<!--break--></p>

<p>The <strong>MAUtil::Moblet</strong> class takes care of the application main loop for you. All you need to do is subclass it and implement virtual functions to respond to the events.</p>

<h2>Example: A Basic Moblet Application</h2>
<p>
{syntaxhighlighter brush: cpp;fontsize: 100; first-line: 1; }#include &lt;MAUtil/Moblet.h&gt;
using namespace MAUtil;
class MyMoblet : public Moblet {
public:
	MyMoblet() {
		// Application initialization
	}
	void keyPressEvent(int keyCode) {
		// Handle key presses here
	}
	void keyReleaseEvent(int keyCode) {
		// Handle key releases here
	}
private:
};
// Since this is a C++ program, the main function
// needs to be declared extern "C"
extern "C" int MAMain() {
	Moblet::run(new MyMoblet());
}
{/syntaxhighlighter}</p>

<div class="code"><!-- temp.cpp : generated by JHighlight v(unknown version) (http://jhighlight.dev.java.net) --> <span class="cpp_preproc"> </span><span class="cpp_separator"> </span><span class="cpp_plain"> </span></div>

<p>The static function <strong>Moblet::run()</strong> implements the actual event loop. When it gets events, it distributes them to all registered listeners. The Moblet, being both a <strong>KeyListener</strong> and a <strong>CloseListener</strong>, will recieve these event types. It is recommended to handle other event types by letting your moblet inherit the corresponding listener types, such as <strong>BluetoothListener </strong>and <strong>ConnectionListener</strong>.</p>

<p>Working with connections in Moblet-based applications involves using the <strong>ConnectionListener </strong>interface. You inherit the class and implement the <strong>connEvent()</strong> function. You can use one listener for several connections, but each connection can only be associated with one listener. Once the events are received, you should process them in the same way as in the <a href="/content/developing-classic-procedural-applications">classic model</a>.</p>

<h2>Example: A Moblet Application Using Connections</h2>

<!-- temp.cpp : generated by JHighlight v(unknown version) (http://jhighlight.dev.java.net) --><p>
{syntaxhighlighter brush: cpp;fontsize: 100; first-line: 1; }#include &lt;conprint.h&gt;
#include &lt;MAUtil/Moblet.h&gt;
using namespace MAUtil;
class ConnMoblet : public Moblet, public ConnListener {
private:
	// Variables survive past individual function calls.
	char mBuffer[160];
	Handle mConn;
public:
	ConnMoblet() {
		// Application initialization goes here.
		InitConsole();
		ConsoleDelay = 0;
		ConsoleLogging = 1;
		// Create a connection.
		printf("Connecting...\n");
		mConn = maConnect("http://www.example.com/"); // Will cause a CONNECT event.
		// Register for events.
		setConnListener(mConn, this);
	}
	void closeConn() {
		maConnClose(mConn);
		removeConnListener(mConn);
	}
	void connEvent(const CONN_EVENT_DATA&amp; data) {
		if(data.opType == CONNOP_CONNECT) {
			// The Connect operation is complete.
			if(data.result &lt; 0) {
				printf("Connect error %i\n", data.result);
				closeConn();
			} else {
				printf("HTTP result %i\n", data.result);
				// Start reading data.
				maConnRead(mConn, mBuffer, sizeof(mBuffer) - 1); 
 // Will cause a CONN READ event.
			}
		} else if(data.opType == CONNOP_READ) {
			// The Read operation is complete.
			if(data.result == CONNERR_CLOSED) {
				printf("Connection closed.\n");
				closeConn();
			} else if(data.result &lt; 0) {
				printf("Read error %i\n", data.result);
				closeConn();
			} else {
				printf("Read %i bytes:\n", data.result);
				// Zero-terminate buffer, so it can be printed.
				mBuffer[data.result] = 0;
				PrintConsole(mBuffer);
				// Read more data.
				maConnRead(mConn, mBuffer, sizeof(mBuffer) - 1);
			}
		}
	}
	void keyPressEvent(int keyCode) {
		if(keyCode == MAK_0)
		maExit(0);
	}
};
extern "C" int MAMain() {
	Moblet::run(new ConnMoblet());
}&nbsp;{/syntaxhighlighter}</p>

        </div>
        
        <!-- Content Panel -->
        <div data-role="panel"
            id="panel-content"
            data-position="left"
            data-display="overlay"
            data-mini="false"
            data-theme="a">
           <!-- <a href="#"
                data-rel="close"
                data-role="button"
                data-mini="false"
                data-icon="delete"
                data-inline="true">Close</a> -->
            
            <!--
            <div data-role="collapsible-set" data-theme="c" data-content-theme="d">
                <div data-role="collapsible">
                    <h3>Quick Start</h3>
                    <ul data-role="listview" data-inset="false">
                        <li><a data-ajax="false" href="#">Your First C/C++ App</a></li>
                        <li><a data-ajax="false" href="#">Your First JavaScript App</a></li>
                        <li><a data-ajax="false" href="#">Kickstart MoSync Reload</a></li>
                    </ul>
                </div>
                <div data-role="collapsible">
                    <h3>C/C++</h3>
                    <ul data-role="listview" data-inset="false">
                        <li><a rel="external" href="http://www.mosync.com/files/imports/doxygen/latest/html/index.html">API Reference</a></li>
                        <li><a data-ajax="false" href="../../../../cpp/guides/index.html">Coding Guides</a></li>
                        <li><a data-ajax="false" href="../../../../cpp/tutorials/index.html">Tutorials</a></li>
                        <li><a data-ajax="false" href="../../../../cpp/examples/index.html">Example Apps</a>
                    </ul>
                </div>
                <div data-role="collapsible">
                    <h3>JavaScript</h3>
                    <ul data-role="listview" data-inset="false">
                        <li><a rel="external" href="http://www.mosync.com/files/imports/doxygen/latest/html5/index.html">API Reference</a></li>
                        <li><a data-ajax="false" href="../../../../js/guides/index.html">Coding Guides</a></li>
                        <li><a data-ajax="false" href="../../../../js/tutorials/index.html">Tutorials</a></li>
                        <li><a data-ajax="false" href="../../../../js/examples/index.html">Example Apps</a></li></li>
                    </ul>
                </div>
                <div data-role="collapsible">
                    <h3>Tools</h3>
                    <ul data-role="listview" data-inset="false">
                        <li><a data-ajax="false" href="">MoSync SDK</a></li>
                        <li><a data-ajax="false" href="">MoSync Reload</a></li>
                    </ul>
                </div>
                <div data-role="collapsible">
                    <h3>Products</h3>
                    <ul data-role="listview" data-inset="false">
                        <li><a data-ajax="false" href="">MoSync SDK</a></li>
                        <li><a data-ajax="false" href="">MoSync Reload</a></li>
                        <li><a data-ajax="false" href="">Product Comparison</a></li>
                    </ul>
                </div>
            </div>
            -->
            
            <ul data-role="listview" data-inset="false" data-mini="false" data-theme="c">
                <li data-role="list-divider" data-theme="a">Contents</li>
                <li><a data-ajax="false" href="../../../../home/index.html">Overview</a></li>
                <li><a data-ajax="false" href="#">Screencasts</a></li>

                <li data-role="list-divider" data-theme="a">Quick Start</li>
                <li><a data-ajax="false" href="#">Your First C/C++ App</a></li>
                <li><a data-ajax="false" href="#">Your First JavaScript App</a></li>
                <li><a data-ajax="false" href="#">Kickstart MoSync Reload</a></li>
                
                <li data-role="list-divider" data-theme="a">C/C++</li>
                <li><a rel="external" href="http://www.mosync.com/files/imports/doxygen/latest/html/index.html">API Reference</a></li>
                <li><a data-ajax="false" href="../../../../cpp/guides/index.html">Coding Guides</a></li>
                <li><a data-ajax="false" href="../../../../cpp/tutorials/index.html">Tutorials</a></li>
                <li><a data-ajax="false" href="../../../../cpp/examples/index.html">Example Apps</a>

                <li data-role="list-divider" data-theme="a">JavaScript</li>
                <li><a rel="external" href="http://www.mosync.com/files/imports/doxygen/latest/html5/index.html">API Reference</a></li>
                <li><a data-ajax="false" href="../../../../js/guides/index.html">Coding Guides</a></li>
                <li><a data-ajax="false" href="../../../../js/tutorials/index.html">Tutorials</a></li>
                <li><a data-ajax="false" href="../../../../js/examples/index.html">Example Apps</a></li></li>

                <li data-role="list-divider" data-theme="a">Tools</li>
                <li><a data-ajax="false" href="">MoSync SDK</a></li>
                <li><a data-ajax="false" href="">MoSync Reload</a></li>

                <li data-role="list-divider" data-theme="a">Products</li>
                <li><a data-ajax="false" href="">MoSync SDK</a></li>
                <li><a data-ajax="false" href="">MoSync Reload</a></li>
                <li><a data-ajax="false" href="">Product Comparison</a></li>
            </ul>
        </div>
    </div>
</body>
</html>
